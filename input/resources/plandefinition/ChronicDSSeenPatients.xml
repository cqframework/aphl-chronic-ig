<PlanDefinition xmlns="http://hl7.org/fhir">
   <id value="ChronicDSSeenPatients"></id>
   <contained>
      <Library xmlns="http://hl7.org/fhir">
         <id value="effective-data-requirements"></id>
         <name value="EffectiveDataRequirements"></name>
         <status value="active"></status>
         <type>
            <coding>
               <system value="http://terminology.hl7.org/CodeSystem/library-type"></system>
               <code value="module-definition"></code>
            </coding>
         </type>
         <relatedArtifact>
            <type value="depends-on"></type>
            <display value="FHIR model information"></display>
            <resource value="http://fhir.org/guides/cqf/common/Library/FHIR-ModelInfo|4.0.1"></resource>
         </relatedArtifact>
      </Library>
   </contained>
   <extension id="effective-data-requirements" url="http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-effectiveDataRequirements">
      <valueCanonical value="#effective-data-requirements"></valueCanonical>
   </extension>
   <extension url="http://hl7.org/fhir/uv/crmi/StructureDefinition/crmi-softwaresystem">
      <valueReference>
         <reference value="Device/cqf-tooling"></reference>
      </valueReference>
   </extension>
   <url value="http://fhir.org/guides/cqf/aphl/chronic-ds/PlanDefinition/ChronicDSSeenPatients"></url>
   <name value="ChronicDSSeenPatients"></name>
   <title value="Chronic Disease Surveillance Reporting Specification for Seen Patients Cohort"></title>
   <type>
      <coding>
         <system value="http://terminology.hl7.org/CodeSystem/plan-definition-type"></system>
         <code value="workflow-definition"></code>
         <display value="Workflow Definition"></display>
      </coding>
   </type>
   <status value="active"></status>
   <experimental value="true"></experimental>
   <date value="2025-09-25T08:22:16.722-05:00"></date>
   <description value="Reporting specification for Chronic Disease Surveillance for Seen Patients Cohort"></description>
   <jurisdiction>
      <coding>
         <system value="urn:iso:std:iso:3166"></system>
         <code value="US"></code>
         <display value="United States of America"></display>
      </coding>
      <text value="United States of America"></text>
   </jurisdiction>
   <effectivePeriod>
      <start value="2021-06-01"></start>
   </effectivePeriod>
   <library value="http://fhir.org/guides/cqf/aphl/chronic-ds/Library/SeenPatients"></library>
   <action id="start">
      <description value="This action represents the start of the reporting workflow in response to the encounter-end event"></description>
      <textEquivalent value="Start the reporting workflow in response to an encounter-end event"></textEquivalent>
      <code>
         <coding>
            <system value="http://hl7.org/fhir/us/medmorph/CodeSystem/us-ph-plandefinition-actions"></system>
            <code value="initiate-reporting-workflow"></code>
         </coding>
      </code>
      <trigger id="encounter-end">
         <type value="named-event"></type>
         <name value="encounter-end"></name>
      </trigger>
      <relatedAction>
         <actionId value="evaluate-measure"></actionId>
         <relationship value="before-start"></relationship>
         <offsetDuration>
            <value value="24"></value>
            <system value="http://unitsofmeasure.org"></system>
            <code value="h"></code>
         </offsetDuration>
      </relatedAction>
   </action>
   <action id="evaluate-measure">
      <description value="This action represents the evaluation of the measure."></description>
      <textEquivalent value="Evaluate measure"></textEquivalent>
      <code>
         <coding>
            <system value="http://hl7.org/fhir/us/medmorph/CodeSystem/us-ph-plandefinition-actions"></system>
            <code value="evaluate-measure"></code>
         </coding>
      </code>
      <input id="patient">
         <type value="Patient"></type>
      </input>
      <input id="conditions">
         <type value="Condition"></type>
      </input>
      <input id="encounter">
         <type value="Encounter"></type>
      </input>
      <input id="mr">
         <type value="MedicationRequest"></type>
      </input>
      <input id="obs">
         <type value="Observation"></type>
      </input>
      <output id="measurereport">
         <type value="MeasureReport"></type>
         <profile value="http://hl7.org/fhir/MeasureReport"></profile>
      </output>
      <relatedAction>
         <actionId value="report-ds"></actionId>
         <relationship value="before-start"></relationship>
      </relatedAction>
      <definitionCanonical value="http://fhir.org/guides/cqf/aphl/chronic-ds/Measure/SeenPatients"></definitionCanonical>
   </action>
   <action id="report-ds">
      <description value="This action represents the reporting of the Chronic Disease Surveillance event."></description>
      <textEquivalent value="Report Chronic Disease Surveillance"></textEquivalent>
      <code>
         <coding>
            <system value="http://hl7.org/fhir/us/medmorph/CodeSystem/us-ph-plandefinition-actions"></system>
            <code value="execute-reporting-workflow"></code>
         </coding>
      </code>
      <condition>
         <kind value="applicability"></kind>
         <expression>
            <language value="text/fhirpath"></language>
            <expression value="%measurereport.exists() and %measurereport.group.select(population).where(code.coding.where(code = 'initial-population').exists() and count &gt; 0).exists()"></expression>
         </expression>
      </condition>
      <input id="measurereport">
         <type value="MeasureReport"></type>
      </input>
      <action id="create-eicr">
         <description value="This action invokes the creation of the eICR report."></description>
         <textEquivalent value="Create eICR"></textEquivalent>
         <code>
            <coding>
               <system value="http://hl7.org/fhir/us/medmorph/CodeSystem/us-ph-plandefinition-actions"></system>
               <code value="create-report"></code>
            </coding>
         </code>
         <input id="patient">
            <type value="Patient"></type>
         </input>
         <input id="conditions">
            <type value="Condition"></type>
         </input>
         <input id="encounter">
            <type value="Encounter"></type>
         </input>
         <input id="mr">
            <type value="MedicationRequest"></type>
         </input>
         <input id="obs">
            <type value="Observation"></type>
         </input>
         <input id="measurereport">
            <type value="MeasureReport"></type>
         </input>
         <output id="eicr-report-ChronicDSSeenPatients">
            <type value="Bundle"></type>
            <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-measurereport-bundle"></profile>
         </output>
         <relatedAction>
            <actionId value="validate-eicr"></actionId>
            <relationship value="before-start"></relationship>
         </relatedAction>
      </action>
      <action id="validate-eicr">
         <description value="This action represents the validation of the eICR."></description>
         <textEquivalent value="Validate eICR"></textEquivalent>
         <code>
            <coding>
               <system value="http://hl7.org/fhir/us/medmorph/CodeSystem/us-ph-plandefinition-actions"></system>
               <code value="validate-report"></code>
            </coding>
         </code>
         <input id="eicr-report-ChronicDSSeenPatients">
            <extension url="http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-relateddata-extension">
               <valueString value="eicr-report-ChronicDSSeenPatients"></valueString>
            </extension>
            <type value="Bundle"></type>
         </input>
         <output id="validated-eicr-report">
            <type value="Bundle"></type>
            <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-document-bundle"></profile>
         </output>
         <relatedAction>
            <actionId value="submit-eicr"></actionId>
            <relationship value="before-start"></relationship>
         </relatedAction>
      </action>
      <action id="submit-eicr">
         <description value="This action represents the validation of the eICR."></description>
         <textEquivalent value="Submit eICR"></textEquivalent>
         <code>
            <coding>
               <system value="http://hl7.org/fhir/us/medmorph/CodeSystem/us-ph-plandefinition-actions"></system>
               <code value="submit-report"></code>
            </coding>
         </code>
         <input id="validated-eicr-report">
            <extension url="http://hl7.org/fhir/us/ecr/StructureDefinition/us-ph-relateddata-extension">
               <valueString value="validated-eicr-report"></valueString>
            </extension>
            <type value="Bundle"></type>
         </input>
         <output id="eicr-report-submitted">
            <type value="Bundle"></type>
            <profile value="http://hl7.org/fhir/us/ecr/StructureDefinition/eicr-document-bundle"></profile>
         </output>
      </action>
   </action>
</PlanDefinition>